<h2>通知一覧</h2>

<div class="mb-3 d-flex gap-2">
  <%= link_to "すべて既読にする",
              mark_all_as_read_notifications_path,
              method: :patch,
              class: "btn btn-primary" %>

  <%= link_to "既読通知を削除",
              delete_read_notifications_path,
              method: :delete,
              data: { confirm: "本当に既読通知を削除しますか？" },
              class: "btn btn-danger" %>
</div>

<ul class="p-0">
  <% @notifications.each do |n| %>
    <li class="<%= n.read ? 'notification-read' : 'notification-unread' %>">
      
      <%= n.actor.name %>

      <% case n.action
      when "comment" %>
        <% if n.notifiable&.post %>
          があなたのレビュー「<%= n.notifiable.post.title %>」にコメントしました
        <% else %>
          （このレビューは削除されました）
        <% end %>

      <% when "like" %>
        <% if n.notifiable&.post %>
          があなたのレビュー「<%= n.notifiable.post.title %>」にいいねしました
        <% else %>
          （このレビューは削除されました）
        <% end %>

      <% when "follow" %>
        があなたをフォローしました

      <% when "community_request" %>
        <% if n.notifiable&.community.present? %>
          がコミュニティ「<%= n.notifiable.community.name %>」に参加申請しました
        <% else %>
          （このコミュニティの情報は削除されました）
        <% end %>

      <% when "community_approved" %>
        <% if n.notifiable&.community.present? %>
          コミュニティ「<%= n.notifiable.community.name %>」への参加が承認されました
        <% else %>
          （このコミュニティの情報は削除されたため表示できません）
        <% end %>

      <% end %>

      <%# notifiable が存在する場合だけ詳細を表示 %>
      <% if n.notifiable.present? %>
        <%= link_to "詳細", notification_path(n), class: "ms-2" %>
      <% end %>
    </li>
  <% end %>
</ul>