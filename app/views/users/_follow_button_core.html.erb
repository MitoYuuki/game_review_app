<%# 自分自身には表示しない %>
<% return if current_user == user %>

<%# ログインしていて、かつゲストでない場合のみ操作可能 %>
<% if user_signed_in? && !current_user.guest? %>

  <% if current_user.following?(user) %>
    <% relationship = current_user.active_relationships.find_by(followed_id: user.id) %>
    <%= button_to "フォロー中",
          relationship_path(relationship),
          method: :delete,
          remote: true,
          data: { turbo: false },
          class: "btn btn-secondary btn-sm" %>
  <% else %>
    <%= button_to "フォローする",
          relationships_path(followed_id: user.id),
          method: :post,
          remote: true,
          data: { turbo: false },
          class: "btn btn-primary btn-sm" %>
  <% end %>

<% else %>
  <%# ゲスト or 未ログイン用（押せない表示） %>
  <button class="btn btn-secondary btn-sm" disabled>
    フォロー（ログインが必要）
  </button>
<% end %>
